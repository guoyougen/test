<div style='display: none'>
  Date: 2022-01-15 22:44:06
  LastEditors: gyg
  LastEditTime: 2022-01-17 18:35:50
  FilePath: \test\1_15@存储.mm.md
</div>

# 深入理解文件系统（存储部分）

>万物皆文件

## 文件、目录和inode是什么

### 什么是文件

 **文件 :**  数据+文件属性（文件名称 类型 创建时间 所有者 大小 改文件在磁盘上的block指针位置）

2. 什么是目录



- **目录 :**  就是一个表，没有任何文件，完全就不是一个容器（是文件和inode值的对应关系表）

### inode
每个文件都会对应一个inode值
inode 值存储了文件的元数据信息
文件类型 文件权限 UID GID 文件连接数 文件大小 文件创建时间 文件的数据块block在磁盘上的块指针

对人而言：识别的是文件名
对系统而言：认识的是inode 
什么是目录 目录是 文件名和inode的对应的表。

系统到底是如何工作的

cp 系统分配一个新的node值 并且添加到node表
在新的目录里面 给这个inode 关联一个文件名
把数据拷贝到磁盘的新位置

mv 在新的目录下，创建一条列表记录 关联源文件的inode值 新的文件名会删除旧的目录下 文件和inode 关联关系
原数据在磁盘上未发生任何改动，所有元属性全部保存

硬链接 ln 源文件 目标位置 + 新名称
就是把文件的inode值 关联给了一个新的名称 并且加入了目录列表
本质上是同一个文件 多了一个入口

硬链接 绝对不能跨越文件系统的

软链接 ln -s 源文件 目标位置+新名称
会产生一个新的文件 用来执行之前那个文件 会产生新的inode值
可以跨越文件系统

rm 链接数-1 如果此时链接数=0 则直接回收该文件
    文件和inode 映射关系会从目录中拿掉，同时磁盘指针会标志该存储区域可用，但是数据并不会擦除，直到下次被其他数据覆盖
链接数 不等于0 inode 值依然保留，只会把目录当中的一个连接拿掉，其他的文件元数据保持不变

文件类型:
类型|缩写
:-: | :-:
普通文件 |-
目录|d
链接文件|l
设备文件|c  
^|b 

文件系统的使用情况
`df` |
:-: |:-:
-h|
-i|
T|

`du`|查看目录大小
:-: | :-:



linux设备命名方式
SATA 机械硬盘 /usb   |  /dev/sda  | /dev/sdb |  /dev/sdc
:-: | :-: | :-: |:-:
虚拟机里面           |   /dev/vda  | /dev/vdb|/dev/vdc
SSD 固态硬盘          | /dev/nvme1|/dev/nvme2|/dev/nvme3
逻辑卷|/dev/mapper1|/dev/mapper2|/dev/mapper3

识别文件系统的设备

分区：将硬盘的整体存储空间划分多个独立的区域

格式化：按照要求创建一个新的文件系统

 文件系统：NTFS FAT32 ext2 ext3 ext4 xfs
 光盘：ISO

 集群文件系统
 分布式文件系统
 网络文件系统 NFS

存储方式 三类

1. DAS：直连式存储 最传统 直接把磁盘连接在设备
2. NAS：网络附属存储 基于文件的存储，需要服务器对自己的存储进行分区格式化，挂载变成了一个目录 通过server把自己的文件夹共享出去 用户client 通过网络来访问server，共享文件夹
用户把文件信息发给server ，然后server替这个用户进行 读写操作
3. SAN：storage area network 存储区域网络 是基于数据块的存储 存储区域网络 可以理解为读取了一大块虚拟磁盘

虚拟磁盘是通过存储服务器，然后通过LUN ID 每一个LUN都有一个ID 可以被用户挂载

SCSI服务就是用来实现SAN存储网络的

nas是靠以太网传输的 TCP/IP
10G 通过NAS网络传输 需要分片 TCP/IP 最大传输单元 1500byte 再加上TCP服务头部 ip头部 mac头部 
nas传输文件 效率低下 


SAN有两种传输模式
1. 以太网
2. FC网络  FC交换机 FC网卡 光纤 FC网络支持巨型数据包 传输速度可以达到 每秒 8G/16G 通常把SAN 叫做FCSAN

